# MIDI Parser - Note Timing Validator

A Python script for validating MIDI files, specifically ensuring that note-on events occur before their corresponding note-off events.

## Features

- Parse MIDI files and extract note timing information
- Validate that each note-on event has a corresponding note-off event
- Verify that note-on timestamps are earlier than note-off timestamps
- Detect common MIDI errors:
  - Missing note-off events (unclosed notes)
  - Missing note-on events
  - Double note-on without note-off in between
- Generate detailed error reports for debugging
- Command-line interface for easy integration into workflows

## Requirements

- Python 3.7+
- `mido` library for MIDI file parsing

Install dependencies:
```bash
pip install mido
```

## Usage

### Command Line

Validate a MIDI file from the command line:

```bash
python3 midi_parser.py <midi_file_path>
```

The script will print a validation report and exit with:
- Exit code 0 if the file is valid
- Exit code 1 if validation errors are found

Example:
```bash
python3 midi_parser.py my_song.mid
```

### Python API

Use the module programmatically in your Python code:

```python
from midi_parser import MIDIParser, validate_midi_file

# Simple validation
is_valid = validate_midi_file("my_song.mid", verbose=True)

# Detailed validation with error access
parser = MIDIParser("my_song.mid")
events = parser.parse()
is_valid, errors = parser.validate()

if not is_valid:
    for error in errors:
        print(f"{error.error_type}: {error.message}")
```

## Examples

See `example_midi_parser_usage.py` for complete usage examples including:
- Basic validation
- Detailed validation with programmatic access to events and errors
- Creating and validating MIDI files

Run the examples:
```bash
python3 example_midi_parser_usage.py
```

## Testing

Run the test suite to verify functionality:

```bash
python3 test_midi_parser.py
```

The test suite creates various MIDI files with known issues and validates that the parser correctly identifies them.

## Error Types

The validator detects the following error types:

- **`missing_note_off`**: A note-on event was found without a corresponding note-off, or a second note-on occurred before the first was closed
- **`missing_note_on`**: A note-off event was found without a preceding note-on
- **`invalid_timing`**: A note-on event occurs after its corresponding note-off (timestamp error)
- **`unclosed_note`**: A note-on event was found but the file ended before a note-off was received

## Module Design

The module follows a modular design with the following components:

### Classes

- **`NoteEvent`**: Dataclass representing a single note event with timing information
- **`ValidationError`**: Dataclass representing a validation error with details
- **`MIDIParser`**: Main class for parsing and validating MIDI files

### Key Methods

- **`parse()`**: Parse MIDI file and extract note events
- **`validate()`**: Validate note timing and return errors
- **`report_errors()`**: Generate human-readable error report
- **`validate_midi_file()`**: Convenience function for quick validation

## Integration with savellysKone

This tool can be used to validate MIDI files generated by the savellysKone music generation system, ensuring that generated compositions have correct note timing.

## License

This script is part of the savellysKone project.
